# mcg-api-examples
Examples for connecting to the MCG API taken from the API Getting Started manual

(c) Copyright 2023 Premier Heart, LLC


###Basic API Connectivity

* simple_connection.py - Tests that a connection can be made to the API server
```
bash# MCG_API_TOKEN_FILE='.token/mcg_api_jwt.dat' python simple_connection.py
Connecting to unused endpoint. Should print 'ERROR /':
ERROR /
```

* error_handling.py - Demonstrates how to handle various connection errors
```
bash# MCG_API_TOKEN_FILE='.token/mcg_api_jwt.dat' python error_handling.py
[01] Connecting to invalid server
 ... Caught exception
[02] Connecting to invalid path
 ... Caught 401 error
[03] Connecting with empty token
 ... Caught 401 error
[04] Connecting with invalid token
 ... Caught 401 error
[05] Connecting with bad/expired token
 ... Caught 401 error
[06] Connecting with valid token and empty request
 ... Caught error 'API request error': Missing 'analysis' in request 
[07] Connecting with valid token and incorrect type
 ... Caught error 'API request error': Unsupported object type 'MyBrokenType 
[08] Connecting with valid token and invalid request
 ... Caught error 'API request error': Missing 'input' in request 
[09] Connecting with valid token and empty request input
 ... Caught error 'Insufficient input data provided': 1+ inputs required 
[10] Connecting with valid token and invalid request input
 ... Caught error 'API request error': Unsupported object type 'MyBrokenType 
[11] Connecting with valid token and invalid analysis type
 ... Caught error: Extension not found
```    

* basic_analysis_request.py - Demonstrates how to send an AnalysisRequest to the API server. This uses random data for the ECG inputs, which may result in an Error object being returned instead of an AnalysisResult.
```
bash# MCG_API_TOKEN_FILE='.token/mcg_api_jwt.dat' python basic_analysis_request.py
Analysis Results:
	object-type: analysis-result
	locale: en-US
	encoding: utf-8
	framework: {'name': 'BSIA', 'version': '1.0.1', 'description': 'BioSignal Information Analysis framework', 'notice': 'Experimental software: NOT FOR CLINICAL USE. (c) Copyright 2022 Premier Heart, LLC'}
	id: None
	results: {'source': 'mcg-avg', 'sample': '2', 'category': 'N/A', 'positive':
/* ... OMITTED ... */
}]'}]
	warnings: []
```

* send_ecg_files.py - Demonstrates how to send ECG JSON files for analysis and display the results.
```
bash# MCG_API_TOKEN_FILE='.token/mcg_api_jwt.dat' python send_ecg_files.py
Read input: /home/ph/projects/mcg-api-examples/data/ecg_1.json
Read input: /home/ph/projects/mcg-api-examples/data/ecg_2.json
Read input: /home/ph/projects/mcg-api-examples/data/ecg_3.json
Results Summary:
	object-type: analysis-result
	locale: en-US
	encoding: utf-8
	framework: {'name': 'BSIA', 'version': '1.0.1', 'description': 'BioSignal Information Analysis framework', 'notice': 'Experimental software: NOT FOR CLINICAL USE. (c) Copyright 2022 Premier Heart, LLC'}
	id: None
	Diagnosis generated by mcg-avg using input 2 as a representative sample
	MCG Category: N/A
	Conditions detected (positives):
		Impression : 5.0
		Disease Severity : 6.5
/* ... OMITTED ... */
	Tracing Quality:
		0 : 90
		1 : 90
		2 : 90
	warnings: []
Attachments:
```
* multiple_output_request.py - Demonstrates how to request multiple output files, which will be included in the AnalysisResults object as attachments.
```
bash# MCG_API_TOKEN_FILE='.token/mcg_api_jwt.dat' python multiple_output_request.py
Read input: /home/ph/projects/mcg-api-examples/data/ecg_1.json
Read input: /home/ph/projects/mcg-api-examples/data/ecg_2.json
Read input: /home/ph/projects/mcg-api-examples/data/ecg_3.json
Results Summary:
	object-type: analysis-result
	locale: en-US
	encoding: utf-8
	framework: {'name': 'BSIA', 'version': '1.0.1', 'description': 'BioSignal Information Analysis framework', 'notice': 'Experimental software: NOT FOR CLINICAL USE. (c) Copyright 2022 Premier Heart, LLC'}
	id: None
	Diagnosis generated by mcg-avg using input 2 as a representative sample
	MCG Category: N/A
	Conditions detected (positives):
		Impression : 5.0
		Disease Severity : 6.5
/* ... OMITTED ... */
	Tracing Quality:
		0 : 90
		1 : 90
		2 : 90
	warnings: []
Attachments:
	[0] result-group from result-json for input '1' : application/x-java-object (in-memory JSON object)
	[1] result-sample from result-json for input '0' : application/x-java-object (in-memory JSON object)
	[2] result-sample from result-json for input '1' : application/x-java-object (in-memory JSON object)
	[3] result-sample from result-json for input '2' : application/x-java-object (in-memory JSON object)
	[4] result-explain-group from result-explain-json for input '1' : application/x-java-object (in-memory JSON object)
	[5] result-explain-sample from result-explain-json for input '0' : application/x-java-object (in-memory JSON object)
	[6] result-explain-sample from result-explain-json for input '1' : application/x-java-object (in-memory JSON object)
	[7] result-explain-sample from result-explain-json for input '2' : application/x-java-object (in-memory JSON object)
	[8] feature-group from feature-json for input '1' : application/x-java-object (in-memory JSON object)
	[9] feature-sample from feature-json for input '0' : application/x-java-object (in-memory JSON object)
	[10] feature-sample from feature-json for input '1' : application/x-java-object (in-memory JSON object)
	[11] feature-sample from feature-json for input '2' : application/x-java-object (in-memory JSON object)
	[12] transform-sample from transform-json for input '0' : application/x-java-object (in-memory JSON object)
	[13] transform-sample from transform-json for input '1' : application/x-java-object (in-memory JSON object)
	[14] transform-sample from transform-json for input '2' : application/x-java-object (in-memory JSON object)
	[15] transform-heatmap-amp.V5 from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 104719-byte file)
	[16] transform-heatmap-amp.II from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 104635-byte file)
	[17] transform-heatmap-aps.V5 from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 113311-byte file)
	[18] transform-heatmap-aps.II from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 112693-byte file)
	[19] transform-heatmap-ccr.(V5,II) from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 156335-byte file)
	[20] transform-heatmap-coh.(V5,II) from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 54395-byte file)
	[21] transform-heatmap-imr.(V5,II) from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 107149-byte file)
	[22] transform-heatmap-psa.(V5,II) from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 76549-byte file)
	[23] transform-heatmap-xar.(V5,II) from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 66321-byte file)
	[24] transform-heatmap-cps.(V5,II) from transform-heatmap for input '0,1,2' : image/svg+xml (base64-encoded 113602-byte file)
	[25] report from report-json for input '0,1,2' : application/x-java-object (in-memory JSON object)
```
* tracing_quality_request.py - Demonstrates how to perform an ECG Tracing Quality analysis
```
bash# MCG_API_TOKEN_FILE='.token/mcg_api_jwt.dat' python tracing_quality_request.py
Read input: /home/ph/projects/mcg-api-examples/data/ecg_1.json
Read input: /home/ph/projects/mcg-api-examples/data/ecg_2.json
Read input: /home/ph/projects/mcg-api-examples/data/ecg_3.json
Results Summary:
	object-type: analysis-result
	locale: en-US
	encoding: utf-8
	framework: {'name': 'BSIA', 'version': '1.0.1', 'description': 'BioSignal Information Analysis framework', 'notice': 'Experimental software: NOT FOR CLINICAL USE. (c) Copyright 2022 Premier Heart, LLC'}
	id: None
	Tracing Quality: 90
		**  Baseline: 100 Noise: 90 Range: 99
		V5  Baseline: 100 Noise: 90 Range: 99
		II  Baseline: 100 Noise: 100 Range: 100
	ECG Details:
		V5  Count: 8192  High: 2384  Low: 128  Baseline: 787  Total: 6447252  Peak Count: 753  Voltage: 5.64  PPV: 2256
		II  Count: 8192  High: 1841  Low: 193  Baseline: 693  Total: 5681463  Peak Count: 567  Voltage: 4.12  PPV: 1648
	warnings: []
```

###Analysis of API Output
* analyze_features.py
* analyze_result_diagnoses.py
* analyze_result_transforms.py

###Advanced Analysis Types
* differential_analysis_request.py
* diagnosis_trace.py

###Displaying API output
* extract-transform-heatmaps.py
* transform_heatmap_output.py
* transform_topo_plot.py
* generate_pdf_report.py
